<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="riversCentralAsia">
<title>Preparation of climate forcing • riversCentralAsia</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Preparation of climate forcing">
<meta property="og:description" content="riversCentralAsia">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">riversCentralAsia</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/00-introduction.html">Introduction to the package</a>
    <a class="dropdown-item" href="../articles/01-description_raw_data.html">Description of data raw types</a>
    <a class="dropdown-item" href="../articles/01-discharge-processing-examples.html">Discharge processing examples</a>
    <a class="dropdown-item" href="../articles/02-preparation-of-climate-forcing.html">Preparation of climate forcing</a>
    <a class="dropdown-item" href="../articles/03-RSMinerveIO.html">I/O for RS Minerve</a>
    <a class="dropdown-item" href="../articles/04-glacier-functions.html">Glacier utilities</a>
    <a class="dropdown-item" href="../articles/05-snow-calibration.html">Manual calibration of snow water equivalent</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/hydrosolutions/riversCentralAsia/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Preparation of climate forcing</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hydrosolutions/riversCentralAsia/blob/HEAD/vignettes/02-preparation-of-climate-forcing.Rmd" class="external-link"><code>vignettes/02-preparation-of-climate-forcing.Rmd</code></a></small>
      <div class="d-none name"><code>02-preparation-of-climate-forcing.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="preparation-of-a-gis-layer-with-hydrological-response-unit">Preparation of a GIS layer with hydrological response unit<a class="anchor" aria-label="anchor" href="#preparation-of-a-gis-layer-with-hydrological-response-unit"></a>
</h2>
<p>Typically, a river basin is discretized into hydrological response
units (HRU) that capture the hydrological properties of a zone within
the river basin. Often, HRU are derived from digital elevation models
(DEMs) to be able to represent the elevation-dependent timing of snow
melt in a basin. This is especially suitable for mountainous basins
where gravity flow determines the river runoff. However, in lower lying
basins, geology or land use may dominate the hydrology and thus HRU may
have to be derived from geological or land use maps.</p>
<p>The function <code>gen_basinElevationBands</code> allows the
generation of a shape layer with elevation bands derived from a DEM.
Note that you can play with the parameters of the function to adjust the
shapes of the elevation bands.</p>
<p>To reproduce this vignette, please make sure you have this package as
well as the example data package downloaded (see <a href="https://hydrosolutions.github.io/riversCentralAsia/" target="_blank" class="external-link">README</a>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/timetk" class="external-link">timetk</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hydrosolutions.github.io/riversCentralAsia/index.html" class="external-link">riversCentralAsia</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">gis_path</span> <span class="op">&lt;-</span> <span class="st">"../../riversCentralAsia_ExampleData/16076_DEM.tif"</span></span>
<span><span class="va">crs_project</span> <span class="op">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84"</span>  <span class="co"># EPSG:4326, latlon WGS84</span></span>
<span></span>
<span><span class="co"># Parameter definition for the generation of the elevation bands</span></span>
<span><span class="va">band_interval</span> <span class="op">&lt;-</span> <span class="fl">500</span> <span class="co"># in meters. Note that normally you want to work with band intervals of 100 m to 200 m. To make the model less computationally demanding, we work with a coarser resolution of 500 m for this demo. </span></span>
<span><span class="va">holeSize_km2</span> <span class="op">&lt;-</span> <span class="fl">.1</span> <span class="co"># cleaning holes smaller than that size</span></span>
<span><span class="va">smoothFact</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># level of band smoothing</span></span>
<span><span class="va">demAggFact</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># dem aggregation factor (carefully fine-tune this)</span></span>
<span><span class="co">## Delineation</span></span>
<span><span class="va">hru_shp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gen_basinElevationBands.html">gen_basinElevationBands</a></span><span class="op">(</span></span>
<span>  dem_PathN <span class="op">=</span> <span class="va">gis_path</span>, demAggFact <span class="op">=</span> <span class="va">demAggFact</span>, band_interval <span class="op">=</span> <span class="va">band_interval</span>, </span>
<span>  holeSize_km2 <span class="op">=</span> <span class="va">holeSize_km2</span>, smoothFact <span class="op">=</span> <span class="va">smoothFact</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Control output</span></span>
<span><span class="va">hru_shp</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now, only minor post-processing (like adding a name attribute) is
further required and the HRU layer is ready for import to RS Minerve for
use in the automated model creation. The open-source book Modeling of
Hydrological Systems in Semi-Arid Central Asia, <a href="https://hydrosolutions.github.io/caham_book/geospatial_data.html" target="_blank" class="external-link">section on geospatial data preparation</a> gives
step-by-step instructions for this.</p>
</div>
<div class="section level2">
<h2 id="extraction-of-climate-data-on-hydrological-response-units">Extraction of climate data on hydrological response units<a class="anchor" aria-label="anchor" href="#extraction-of-climate-data-on-hydrological-response-units"></a>
</h2>
<p>We recommend the use of daily precipitation and temperature data from
the CHELSA data set (made available by WSL)<span class="citation">(Karger et al. 2017, 2020)</span>. The data is
downloaded from the CHELSA server, then extracted to each hydrological
response unit and reformated to the RS MINERVE forcing input format
using function <code>gen_HRU_Climate_CSV_RSMinerve</code>. Please note
that the global CHELSA data set at 1km grid resolution requires several
GB of free storage space on your computer.</p>
<p>This process is demonstrated in detail in the book Modelling of
Hydrological Systems in Semi-Arid Central Asia, <a href="https://hydrosolutions.github.io/caham_book/climate_data.html#sec-bcds-quantile-mapping" target="_blank" class="external-link">section Climate Data - Downscaling and Bias
Correction</a>. Below we show an example useage from this book chapter.
This example is reproducible with the (larger) example data set from the
book but not with the example data set in this package.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Temperature data processing</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>hist_obs_tas <span class="ot">&lt;-</span> riversCentralAsia<span class="sc">::</span><span class="fu">gen_HRU_Climate_CSV_RSMinerve</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">climate_files =</span> <span class="sc">&lt;</span>List of CHELSA temperature files<span class="sc">&gt;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">catchmentName =</span> <span class="sc">&lt;</span>river_name<span class="sc">&gt;</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">temp_or_precip =</span> <span class="st">"Temperature"</span>,  <span class="co"># To process precipitation data, type "Precipitation"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">elBands_shp =</span> <span class="sc">&lt;</span>hru_shp<span class="sc">&gt;</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">startY =</span> <span class="sc">&lt;</span>start year<span class="sc">&gt;</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">endY =</span> <span class="sc">&lt;</span>end year<span class="sc">&gt;</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">obs_frequency =</span> <span class="sc">&lt;</span><span class="st">'hour'</span>, <span class="st">'day'</span>, or <span class="st">'month'</span><span class="sc">&gt;</span>,  <span class="co"># Note that CHELSA data is available at daily or monthly frequency, not hourly.</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">climate_data_type =</span> <span class="sc">&lt;</span><span class="st">'hist_obs'</span>, <span class="st">'hist_sim'</span>, or <span class="st">'fut_sim'</span><span class="sc">&gt;</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs_in_use =</span> <span class="sc">&lt;</span>a projection code, <span class="cf">for</span> example <span class="st">'+proj=longlat +datum=WGS84'</span><span class="sc">&gt;</span>)</span></code></pre></div>
<p>An example using a single input file is given below.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign names and elevations to the HRU</span></span>
<span><span class="co"># Here we use demo elevations. Typically you would extract elevations from DEM. </span></span>
<span><span class="co">#   Z &lt;- exactextractr::exact_extract(dem, hru_shp, 'mean')</span></span>
<span><span class="va">hru_shp</span> <span class="op">&lt;-</span> <span class="va">hru_shp</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Atb_"</span>, <span class="va">layer</span><span class="op">)</span>, </span>
<span>         Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">2000</span>, <span class="fl">3000</span>, <span class="fl">4000</span><span class="op">)</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># Temperature data processing</span></span>
<span><span class="va">fut_sim_tas</span> <span class="op">&lt;-</span> <span class="fu">riversCentralAsia</span><span class="fu">::</span><span class="fu"><a href="../reference/gen_HRU_Climate_CSV_RSMinerve.html">gen_HRU_Climate_CSV_RSMinerve</a></span><span class="op">(</span></span>
<span>  climate_files <span class="op">=</span> </span>
<span>    <span class="st">"../../riversCentralAsia_ExampleData/tas_day_GFDL-ESM4_ssp126_r1i1p1f1_gr1.nc"</span>,</span>
<span>  catchmentName <span class="op">=</span> <span class="st">"Atbashy"</span>,</span>
<span>  temp_or_precip <span class="op">=</span> <span class="st">"Temperature"</span>,</span>
<span>  elBands_shp <span class="op">=</span> <span class="va">hru_shp</span>,  <span class="co"># from the code chunk above</span></span>
<span>  startY <span class="op">=</span> <span class="fl">2012</span>,</span>
<span>  endY <span class="op">=</span> <span class="fl">2017</span>,</span>
<span>  obs_frequency <span class="op">=</span> <span class="st">"day"</span>, </span>
<span>  climate_data_type <span class="op">=</span> <span class="st">"fut_sim"</span>,</span>
<span>  crs_in_use <span class="op">=</span> <span class="st">'+proj=longlat +datum=WGS84'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This gives you the temperature forcing for each elevation band in a format that can be imported to RS MINERVE. </span></span>
<span><span class="va">fut_sim_tas</span></span>
<span><span class="co"># A tibble: 2,200 x 5</span></span>
<span><span class="co">#   Station             Atb_1             Atb_2             Atb_3             Atb_4            </span></span>
<span><span class="co">#   &lt;chr&gt;               &lt;chr&gt;             &lt;chr&gt;             &lt;chr&gt;             &lt;chr&gt;            </span></span>
<span><span class="co"># 1 Station             Atb_1             Atb_2             Atb_3             Atb_4            </span></span>
<span><span class="co"># 2 X                   1121699.41259477  1137845.07398682  1152073.09136446  1162907.10435686 </span></span>
<span><span class="co"># 3 Y                   4593793.26535944  4597636.57285844  4600746.13179295  4602406.26249851 </span></span>
<span><span class="co"># 4 Z                   1000              2000              3000              4000             </span></span>
<span><span class="co"># 5 Sensor              T                 T                 T                 T                </span></span>
<span><span class="co"># 6 Category            Temperature       Temperature       Temperature       Temperature      </span></span>
<span><span class="co"># 7 Unit                C                 C                 C                 C                </span></span>
<span><span class="co"># 8 Interpolation       Linear            Linear            Linear            Linear           </span></span>
<span><span class="co"># 9 01.01.2012 00:00:00 -14.048846244812  -14.0820846557617 -14.0855207443237 -14.0795421600342</span></span>
<span><span class="co">#10 02.01.2012 00:00:00 -13.4489545822144 -13.4161062240601 -13.4127111434937 -13.4186210632324</span></span>
<span><span class="co"># ... with 2,190 more rows</span></span>
<span><span class="co"># i Use `print(n = ...)` to see more rows</span></span>
<span></span>
<span><span class="co"># You now just need to write the table to csv and import it to RS MINERVE. </span></span>
<span><span class="co"># readr::write_csv(fut_sim_tas, &lt;filename&gt;, na = "NA", col_names = FALSE)</span></span></code></pre></div>
<p>This produces a tibble with the daily average temperatures for each
elevation band in the input elBands_shp layer.</p>
</div>
<div class="section level2">
<h2 id="bias-correction-using-quantile-mapping">Bias correction using quantile mapping<a class="anchor" aria-label="anchor" href="#bias-correction-using-quantile-mapping"></a>
</h2>
<p>Also here, due to the size of the input files, we do not provide a
reproducible example in this package but refer the interested reader to
the book Modelling of Hydrological Systems in Semi-Arid Central Asia, <a href="https://hydrosolutions.github.io/caham_book/climate_data.html#sec-bcds-quantile-mapping" target="_blank" class="external-link">section Climate Data - Downscaling and Bias
Correction</a> where reproducible examples of the downscaling of
projected climate data are available. The bias correction is done using
the <a href="https://CRAN.R-project.org/package=qmap" target="_blank" class="external-link">R
package qmap</a> <span class="citation">(Gudmundsson 2016)</span>.</p>
<p>The synthetic example below demonstrates how the wrapper for qmap in
riversCentral Asia is used to downscale climate projections to each HRU
of the basin.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hist_obs</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span><span class="op">~</span><span class="va">Date</span>, <span class="op">~</span><span class="va">Basin</span>, <span class="op">~</span><span class="va">Pr</span>,</span>
<span>                            <span class="st">"1979-01-01"</span>, <span class="st">"K_eb1"</span>, <span class="fl">0.1</span>,</span>
<span>                            <span class="st">"1979-01-01"</span>, <span class="st">"K_eb2"</span>, <span class="fl">0.2</span>,</span>
<span>                            <span class="st">"1979-01-01"</span>, <span class="st">"K_eb3"</span>, <span class="fl">0.3</span>,</span>
<span>                            <span class="st">"1979-01-02"</span>, <span class="st">"K_eb1"</span>, <span class="fl">0.4</span>,</span>
<span>                            <span class="st">"1979-01-02"</span>, <span class="st">"K_eb2"</span>, <span class="fl">0.5</span>,</span>
<span>                            <span class="st">"1979-01-02"</span>, <span class="st">"K_eb3"</span>, <span class="fl">0.6</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hist_sim</span> <span class="op">&lt;-</span> <span class="va">hist_obs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Basin</span> <span class="op">==</span> <span class="st">"K_eb1"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Basin</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Pr <span class="op">=</span> <span class="va">Pr</span> <span class="op">+</span> <span class="fl">1</span>, Model <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span>
<span><span class="va">hist_sim</span> <span class="op">&lt;-</span> <span class="va">hist_sim</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span><span class="va">hist_sim</span> <span class="op">|&gt;</span></span>
<span>                   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Pr <span class="op">=</span> <span class="va">Pr</span> <span class="op">+</span> <span class="fl">2</span>, Model <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fut_sim</span> <span class="op">&lt;-</span> <span class="va">hist_sim</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Scenario <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span><span class="va">hist_sim</span> <span class="op">|&gt;</span></span>
<span>                   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Pr <span class="op">=</span> <span class="va">Pr</span> <span class="op">+</span> <span class="fl">1</span>, Scenario <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fut_sim</span> <span class="op">&lt;-</span> <span class="va">fut_sim</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span><span class="va">fut_sim</span> <span class="op">|&gt;</span></span>
<span>                   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span> <span class="op">+</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/doQuantileMapping.html">doQuantileMapping</a></span><span class="op">(</span><span class="va">hist_obs</span>, <span class="va">hist_sim</span>, <span class="va">fut_sim</span><span class="op">)</span></span>
<span><span class="va">mapped_hist_sim</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">mapped_fut_sim</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">mapped_hist_sim</span> <span class="op">&lt;-</span> <span class="va">mapped_hist_sim</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Model</span> <span class="op">==</span> <span class="st">"ERA5-CHELSA"</span>, <span class="st">"baseline"</span>, <span class="va">Model</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visually inspect results</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">hist_sim</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Pr</span>, colour <span class="op">=</span> <span class="va">Model</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mapped_hist_sim</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Pr</span>, colour <span class="op">=</span> <span class="va">Model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">hist_obs</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Pr</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"black"</span>, linetype <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fut_sim</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Pr</span>, colour <span class="op">=</span> <span class="va">Model</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mapped_fut_sim</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Pr</span>, colour <span class="op">=</span> <span class="va">Model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Basin"</span>, <span class="st">"Scenario"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-gudmundsson_qmap_2016" class="csl-entry">
Gudmundsson, L. 2016. <span>“Qmap: <span>Statistical</span>
Transformations for Post-Processing Climate Model Output.”</span> <a href="https://CRAN.R-project.org/package=qmap" class="external-link">https://CRAN.R-project.org/package=qmap</a>.
</div>
<div id="ref-karger_climatologies_2017" class="csl-entry">
Karger, Dirk Nikolaus, Olaf Conrad, Jürgen Böhner, Tobias Kawohl, Holger
Kreft, Rodrigo Wilber Soria-Auza, Niklaus E. Zimmermann, H. Peter
Linder, and Michael Kessler. 2017. <span>“Climatologies at High
Resolution for the Earth’s Land Surface Areas.”</span> <em>Scientific
Data</em> 4 (1): 170122. <a href="https://doi.org/10.1038/sdata.2017.122" class="external-link">https://doi.org/10.1038/sdata.2017.122</a>.
</div>
<div id="ref-karger_high-resolution_2020" class="csl-entry">
Karger, Dirk Nikolaus, Dirk R. Schmatz, Gabriel Dettling, and Niklaus E.
Zimmermann. 2020. <span>“High-Resolution Monthly Precipitation and
Temperature Time Series from 2006 to 2100.”</span> <em>Scientific
Data</em> 7 (1): 248. <a href="https://doi.org/10.1038/s41597-020-00587-y" class="external-link">https://doi.org/10.1038/s41597-020-00587-y</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tobias Siegfried, Beatrice Marti.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
